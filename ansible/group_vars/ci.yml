# A configuration to be copied to local.yml when running CI
# It has a few differences from everything.yml (see comments inline)
#
# For use by CI running in containers

epics_modules_build: true
catrust: false
epics_tools: true
docker: true
# the attempt to make docker outside docker work is a failure because the
# compose file tries to mount host folders it cannot see. For the moment
# disable buesky build in CI
bluesky: false

# List the EPICS modules that will be built in this order (base is mandatory)
epics_modules_list:
  - base
  - pvxs
  # Two alternative Python wrappers
  # TODO temporary guards for currently broken combinations
  - "{{ 'p4p' if ansible_python.version.minor < 12 else 'skip' }}"
  - "{{ 'pvapy' if is_redhat and not in_container else 'skip' }}"
  - seq
  - asyn
  - opcua
  # AreaDetector dependencies
  - autosave
  - busy
  - sscan
  - calc
  # TODO Fedora's xmllib2 is too new for ADCore - missing XmlGetGlobal
  # TODO investigate issues with AD in Debian when building in a container - no RELEASE.local
  - "{{ 'adcore' if ansible_distribution in ['ubuntu', 'rocky'] else 'skip' }}"
  - "{{ 'adsimdetector' if ansible_distribution in ['ubuntu', 'rocky'] else 'skip' }}"
  - "{{ 'adpvadriver' if ansible_distribution in ['ubuntu', 'rocky'] else 'skip' }}"

in_container: true
